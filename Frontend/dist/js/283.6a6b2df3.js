"use strict";(self["webpackChunkweb_project"]=self["webpackChunkweb_project"]||[]).push([[283],{5313:function(e,a,i){i.r(a),i.d(a,{default:function(){return J}});var t=i(6768),n=i(4232);const l=e=>((0,t.Qi)("data-v-e3b47e18"),e=e(),(0,t.jt)(),e),s={class:"container"},c={class:"table"},r={class:"title"},o={key:0,class:"spinner-container"},d=l((()=>(0,t.Lk)("i",{class:"pi pi-spin pi-spinner large-spinner"},null,-1))),h=[d],p=l((()=>(0,t.Lk)("i",{class:"pi pi-search"},null,-1))),y={class:"dataTable"},u={class:"p-d-flex p-jc-end p-ai-center"};function m(e,a,i,l,d,m){const f=(0,t.g2)("Button"),_=(0,t.g2)("InputText"),b=(0,t.g2)("InputGroupAddon"),g=(0,t.g2)("InputGroup"),F=(0,t.g2)("Toolbar"),v=(0,t.g2)("Column"),k=(0,t.g2)("DataTable"),C=(0,t.g2)("DeleteModal"),$=(0,t.g2)("AllFinancialsModal");return(0,t.uX)(),(0,t.CE)(t.FK,null,[(0,t.Lk)("div",s,[(0,t.Lk)("div",c,[(0,t.Lk)("h1",r,(0,n.v_)(e.$t("financials_page.title")),1),e.isLoaded?((0,t.uX)(),(0,t.CE)(t.FK,{key:1},[(0,t.bF)(F,null,{start:(0,t.k6)((()=>[(0,t.bF)(f,{icon:"pi pi-file-excel",class:"mr-2",severity:"secondary",onClick:e.exportToExcel},null,8,["onClick"]),(0,t.bF)(f,{icon:"pi pi-print",severity:"secondary",onClick:e.exportToPDF},null,8,["onClick"])])),center:(0,t.k6)((()=>[(0,t.bF)(g,null,{default:(0,t.k6)((()=>[(0,t.bF)(_,{icon:"pi pi-search",modelValue:e.searchText,"onUpdate:modelValue":a[0]||(a[0]=a=>e.searchText=a),placeholder:e.$t("financials_page.search_bar"),style:{width:"30vw"},onInput:e.filterFinancials,rounded:""},null,8,["modelValue","placeholder","onInput"]),(0,t.bF)(b,null,{default:(0,t.k6)((()=>[p])),_:1})])),_:1})])),end:(0,t.k6)((()=>[(0,t.bF)(f,{label:e.$t("financials_page.button_add_financial"),onClick:a[1]||(a[1]=a=>e.openModal())},null,8,["label"])])),_:1}),(0,t.Lk)("div",y,[(0,t.bF)(k,{value:e.filteredFinancials,ref:"tableRef",paginator:!0,rows:10,tableStyle:"width: 100%;"},{empty:(0,t.k6)((()=>[(0,t.eW)((0,n.v_)(e.$t("financials_page.empty_table")),1)])),default:(0,t.k6)((()=>[(0,t.bF)(v,{field:"branch_id",header:e.$t("financials_page.table_column_company"),sortable:"",style:{width:"10%"}},{body:(0,t.k6)((({data:a})=>[(0,t.Lk)("div",null,(0,n.v_)(e.companies[e.branche[a.branch_id]?.company_id]?.name),1)])),_:1},8,["header"]),(0,t.bF)(v,{field:"branch_id",header:e.$t("financials_page.table_column_branch"),sortable:"",style:{width:"15%"}},{body:(0,t.k6)((({data:a})=>[(0,t.Lk)("div",null,(0,n.v_)(e.branche[a.branch_id]?.name),1)])),_:1},8,["header"]),(0,t.bF)(v,{field:"type",header:e.$t("financials_page.table_column_type"),sortable:"",style:{width:"10%"}},{body:(0,t.k6)((({data:a})=>[(0,t.Lk)("div",null,(0,n.v_)(e.getTypeById(a.type)),1)])),_:1},8,["header"]),(0,t.bF)(v,{field:"category",header:e.$t("financials_page.table_column_category"),sortable:"",style:{width:"10%"}},{body:(0,t.k6)((({data:a})=>[(0,t.Lk)("div",null,(0,n.v_)(e.categoryNameById(a.category)),1)])),_:1},8,["header"]),(0,t.bF)(v,{field:"date",header:e.$t("financials_page.table_column_date"),sortable:"",style:{width:"10%"}},{body:(0,t.k6)((({data:a})=>[(0,t.Lk)("data",null,(0,n.v_)(e.formatDate(a.date)),1)])),_:1},8,["header"]),(0,t.bF)(v,{field:"amount",header:e.$t("financials_page.table_column_amount"),sortable:"",style:{width:"10%"}},{body:(0,t.k6)((({data:a})=>[(0,t.Lk)("div",null,(0,n.v_)(e.formatCurrency(a.amount)),1)])),_:1},8,["header"]),(0,t.bF)(v,{field:"actions",header:e.$t("financials_page.table_column_actions"),style:{width:"5%"}},{body:(0,t.k6)((({data:a})=>[(0,t.Lk)("div",u,[(0,t.bF)(f,{icon:"pi pi-pencil",class:"mr-2 mb-2",severity:"success",rounded:"",onClick:i=>e.openModal(a)},null,8,["onClick"]),(0,t.bF)(f,{icon:"pi pi-times",class:"mb-2",severity:"danger",rounded:"",onClick:i=>e.deleteItem(a)},null,8,["onClick"])])])),_:1},8,["header"])])),_:1},8,["value"])])],64)):((0,t.uX)(),(0,t.CE)("div",o,h))])]),e.isDeleteModalVisible?((0,t.uX)(),(0,t.Wv)(C,{key:0,visible:e.isDeleteModalVisible,"onUpdate:visible":a[2]||(a[2]=a=>e.isDeleteModalVisible=a),id:e.idFinancial,items:"financial",onItemDeleted:e.handlerFilteringFinancials},null,8,["visible","id","onItemDeleted"])):(0,t.Q3)("",!0),e.isModalVisible?((0,t.uX)(),(0,t.Wv)($,{key:1,visible:e.isModalVisible,"onUpdate:visible":a[3]||(a[3]=a=>e.isModalVisible=a),id:e.idFinancial,idBranche:e.idBranche,onFinancialUpdated:e.handlerFilteringFinancials},null,8,["visible","id","idBranche","onFinancialUpdated"])):(0,t.Q3)("",!0)],64)}i(4114);var f=i(1357),_=i(8797);const b=e=>((0,t.Qi)("data-v-a642705e"),e=e(),(0,t.jt)(),e),g={class:"flex-container"},F={class:"flex-item"},v={class:"column gap-2 mb-3"},k={for:"company"},C={class:"column gap-2 mb-3"},$={for:"branche"},w={class:"column gap-2 mb-3"},L={for:"company"},V={class:"column gap-2 mb-3"},I={for:"branche"},T={class:"column gap-2 mb-3"},B={for:"type"},D={class:"column gap-2 mb-3"},x={for:"category"},A={class:"flex-item"},S={class:"column gap-2 mb-3"},U={for:"date"},M={class:"column gap-2 mb-3"},j={for:"amount"},E=b((()=>(0,t.Lk)("i",{class:"pi pi-dollar"},null,-1))),N={class:"column gap-2 mb-3"},W={for:"description"};function K(e,a,i,l,s,c){const r=(0,t.g2)("Dropdown"),o=(0,t.g2)("AutoComplete"),d=(0,t.g2)("InputText"),h=(0,t.g2)("Calendar"),p=(0,t.g2)("InputNumber"),y=(0,t.g2)("InputGroupAddon"),u=(0,t.g2)("InputGroup"),m=(0,t.g2)("Textarea"),f=(0,t.g2)("Button"),_=(0,t.g2)("Dialog");return(0,t.uX)(),(0,t.Wv)(_,{visible:e.innerVisible,"onUpdate:visible":a[9]||(a[9]=a=>e.innerVisible=a),modal:!0,header:e.labelTitle,style:{width:"90%",maxWidth:"50rem"}},{footer:(0,t.k6)((()=>[(0,t.bF)(f,{label:e.$t("financials_modal.button_cancel"),severity:"secondary",onClick:e.onCancel},null,8,["label","onClick"]),(0,t.bF)(f,{icon:"pi pi-check",severity:"success",label:e.$t("financials_modal.button_save"),onClick:e.onSave},null,8,["label","onClick"])])),default:(0,t.k6)((()=>[(0,t.Lk)("div",g,[(0,t.Lk)("div",F,[""===e.id?((0,t.uX)(),(0,t.CE)(t.FK,{key:0},[(0,t.Lk)("div",v,[(0,t.Lk)("label",k,(0,n.v_)(e.$t("financials_modal.label_company")),1),(0,t.bF)(r,{modelValue:e.selectedCompany,"onUpdate:modelValue":a[0]||(a[0]=a=>e.selectedCompany=a),onChange:e.onSelectCompany,options:e.companies,optionLabel:"name",optionValue:"_id"},null,8,["modelValue","onChange","options"])]),(0,t.Lk)("div",C,[(0,t.Lk)("label",$,(0,n.v_)(e.$t("financials_modal.label_branch")),1),(0,t.bF)(o,{id:"branche",modelValue:e.selectedBranche,"onUpdate:modelValue":a[1]||(a[1]=a=>e.selectedBranche=a),dropdown:"",suggestions:e.branchNames,onComplete:e.searchBranches},null,8,["modelValue","suggestions","onComplete"])])],64)):((0,t.uX)(),(0,t.CE)(t.FK,{key:1},[(0,t.Lk)("div",w,[(0,t.Lk)("label",L,(0,n.v_)(e.$t("financials_modal.label_company")),1),(0,t.bF)(d,{modelValue:e.selectedCompany,"onUpdate:modelValue":a[2]||(a[2]=a=>e.selectedCompany=a),disabled:""},null,8,["modelValue"])]),(0,t.Lk)("div",V,[(0,t.Lk)("label",I,(0,n.v_)(e.$t("financials_modal.label_branch")),1),(0,t.bF)(d,{id:"branche",modelValue:e.selectedBranche,"onUpdate:modelValue":a[3]||(a[3]=a=>e.selectedBranche=a),disabled:""},null,8,["modelValue"])])],64)),(0,t.Lk)("div",T,[(0,t.Lk)("label",B,(0,n.v_)(e.$t("financials_modal.label_type")),1),(0,t.bF)(r,{id:"type",modelValue:e.selectedType,"onUpdate:modelValue":a[4]||(a[4]=a=>e.selectedType=a),options:e.typeFinancial,onChange:e.onTypeChange,optionLabel:"name"},{option:(0,t.k6)((({option:e})=>[(0,t.eW)((0,n.v_)(e.name),1)])),_:1},8,["modelValue","options","onChange"])]),(0,t.Lk)("div",D,[(0,t.Lk)("label",x,(0,n.v_)(e.$t("financials_modal.label_category")),1),(0,t.bF)(r,{id:"category",modelValue:e.selectedCategory,"onUpdate:modelValue":a[5]||(a[5]=a=>e.selectedCategory=a),options:e.getCategoryForType(e.selectedType.name),onChange:e.getIdCategory,optionLabel:"name"},{option:(0,t.k6)((({option:e})=>[(0,t.eW)((0,n.v_)(e.name),1)])),_:1},8,["modelValue","options","onChange"])])]),(0,t.Lk)("div",A,[(0,t.Lk)("div",S,[(0,t.Lk)("label",U,(0,n.v_)(e.$t("financials_modal.label_date")),1),(0,t.bF)(h,{id:"date",modelValue:e.dateFinancial,"onUpdate:modelValue":a[6]||(a[6]=a=>e.dateFinancial=a),showIcon:"",iconDisplay:"input",dateFormat:"mm/dd/yy"},null,8,["modelValue"])]),(0,t.Lk)("div",M,[(0,t.Lk)("label",j,(0,n.v_)(e.$t("financials_modal.label_amount")),1),(0,t.bF)(u,null,{default:(0,t.k6)((()=>[(0,t.bF)(p,{id:"amount",modelValue:e.financial.amount,"onUpdate:modelValue":a[7]||(a[7]=a=>e.financial.amount=a),inputId:"currency-us",mode:"currency",currency:"USD",locale:"en-US"},null,8,["modelValue"]),(0,t.bF)(y,null,{default:(0,t.k6)((()=>[E])),_:1})])),_:1})]),(0,t.Lk)("div",N,[(0,t.Lk)("label",W,(0,n.v_)(e.$t("financials_modal.label_description")),1),(0,t.bF)(m,{id:"description",modelValue:e.financial.description,"onUpdate:modelValue":a[8]||(a[8]=a=>e.financial.description=a),autoResize:"",rows:"6",cols:"30"},null,8,["modelValue"])])])])])),_:1},8,["visible","header"])}var X=i(1459),O=i(782),P=(0,t.pM)({name:"FinancialModal",props:{id:String,idBranche:String,visible:Boolean},data(){return{financial:{},branche:{},user:{},branches:[],companies:[],branchNames:[],dateFinancial:new Date,labelTitle:this.$t("branches_modal.title_add"),selectedType:{id:0,name:""},selectedCategory:{id:0,name:""},selectedBranche:"",selectedCompany:"",userIdentify:0,userNameIdentify:"",typeFinancial:[{id:1,name:this.$t("array_type_fiancial.revenue")},{id:2,name:this.$t("array_type_fiancial.expense")}],categoryFinancial:{[this.$t("array_type_fiancial.revenue")]:{[this.$t("array_category_financial.product_sales")]:1,[this.$t("array_category_financial.services_rendered")]:2,[this.$t("array_category_financial.commissions")]:3,[this.$t("array_category_financial.property_rent")]:4,[this.$t("array_category_financial.investments")]:5,[this.$t("array_category_financial.others_revenues")]:6},[this.$t("array_type_fiancial.expense")]:{[this.$t("array_category_financial.salaries_benefits")]:7,[this.$t("array_category_financial.rent")]:8,[this.$t("array_category_financial.raw_materials")]:9,[this.$t("array_category_financial.maintenance")]:10,[this.$t("array_category_financial.taxes_fees")]:11,[this.$t("array_category_financial.others_expense")]:12}}}},created(){const e=(0,O.Pj)(),a=e.state.userId,i=e.state.userName;a||i||X.A.push("/"),this.userIdentify=a,this.userNameIdentify=i},computed:{innerVisible:{get(){return this.visible},set(e){e||this.$emit("update:visible",e)}}},async mounted(){await this.fetchUsers(),await this.fetchAllCompanies(),await this.fetchAllBranches(),""!==this.id&&(await this.fetchFinancial(),this.labelTitle=this.$t("branches_modal.title_edit"))},methods:{async fetchUsers(){try{const e=await f.A.get(`/user/${this.userIdentify}`);this.user=e.data}catch(e){console.error("Error fetching user",e)}},async fetchAllCompanies(){try{const e=await f.A.get("/company");this.companies=e.data,this.companies=this.companies.filter((e=>this.user.companies.includes(e._id)))}catch(e){console.error("Error fetching companies",e)}},async fetchAllBranches(){try{const e=await f.A.get("/branch");this.branches=e.data,this.branches=this.branches.filter((e=>this.user.branches.includes(e._id)))}catch(e){console.error("Error fetching branches ",e)}},async fetchFinancial(){try{this.onSelectBranche();const e=await f.A.get(`/financial/${this.id}`);this.financial=e.data,this.selectedType.id=this.financial.type,this.getTypeById(this.selectedType.id),this.getCategoryById(this.financial.category),this.dateFinancial=new Date(this.financial.date);const a=this.branches.find((e=>e._id===this.financial.branch_id));this.selectedBranche=a?a.name:"";const i=this.companies.find((e=>e._id===a?.company_id));this.selectedCompany=i?i.name:"",this.financial.date=this.formatDate(this.financial.date)}catch(e){console.error("Error fetching financials",e)}},async postFinancial(){try{this.onSelectBranche(),this.financial.date=this.dateFinancial.toISOString();const e=await f.A.post("/financial",this.financial),a=e.data.financial._id;this.user.financials.push(a),await f.A.put(`/user/${this.userIdentify}`,this.user)}catch(e){console.error("Error posting financial",e)}},async putFinancial(){try{this.financial.date=this.dateFinancial.toISOString(),await f.A.put(`/financial/${this.id}`,this.financial)}catch(e){console.error("Error posting company",e)}},async onSave(){""!==this.id?await this.putFinancial():await this.postFinancial(),this.innerVisible=!1,this.$emit("financialUpdated")},async onSelectCompany(){await this.fetchAllBranches(),this.branches=this.branches.filter((e=>e.company_id===this.selectedCompany)),this.selectedBranche=""},getTypeById(e){const a=this.typeFinancial.find((a=>a.id===e));a&&(this.selectedType=a)},getCategoryById(e){const a=Object.values(this.categoryFinancial).reduce(((e,a)=>({...e,...a})),{}),i=Object.entries(a).find((([a,i])=>i===e));if(i){const[e,a]=i;this.selectedCategory={id:a,name:e}}else this.selectedCategory={id:0,name:""}},getIdCategory(){this.financial.category=this.selectedCategory.id||0},onTypeChange(){this.financial.type=this.selectedType.id},searchBranches(e){const a=e.query.toLowerCase();this.branchNames=this.branches.filter((e=>e.name&&e.name.toLowerCase().includes(a))).map((e=>e.name))},onSelectBranche(){const e=this.branches.find((e=>e.name===this.selectedBranche))?._id||"";this.financial.branch_id=e},getCategoryForType(e){const a=this.categoryFinancial[e];return a?Object.entries(a).map((([e,a])=>({id:a,name:e}))):[]},formatDate(e){return e?new Date(e).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}):""},onCancel(){this.innerVisible=!1}}}),G=i(1241);const Q=(0,G.A)(P,[["render",K],["__scopeId","data-v-a642705e"]]);var q=Q,R=i(1749),z=(i(5839),i(3230)),Y=(0,t.pM)({name:"FinancialPage",props:{idBranche:{type:String,required:!1}},components:{AllFinancialsModal:q,DeleteModal:_.A},data(){return{financials:[],filteredFinancials:[],branches:[],user:{},branche:{},companies:{},isLoaded:!1,isModalVisible:!1,isDeleteModalVisible:!1,userIdentify:"",userNameIdentify:"",id:"",idFinancial:"",searchText:"",typeFinancial:[{id:1,name:this.$t("array_type_fiancial.revenue")},{id:2,name:this.$t("array_type_fiancial.expense")}],categoryFinancial:{[this.$t("array_category_financial.product_sales")]:1,[this.$t("array_category_financial.services_rendered")]:2,[this.$t("array_category_financial.commissions")]:3,[this.$t("array_category_financial.property_rent")]:4,[this.$t("array_category_financial.investments")]:5,[this.$t("array_category_financial.others_revenues")]:6,[this.$t("array_category_financial.salaries_benefits")]:7,[this.$t("array_category_financial.rent")]:8,[this.$t("array_category_financial.raw_materials")]:9,[this.$t("array_category_financial.maintenance")]:10,[this.$t("array_category_financial.taxes_fees")]:11,[this.$t("array_category_financial.others_expense")]:12}}},created(){const e=(0,O.Pj)(),a=e.state.userId,i=e.state.userName;a||i||X.A.push("/"),this.userIdentify=a,this.userNameIdentify=i},async mounted(){await this.fetchUsers(),await this.fetchCompanies(),await this.fetchCnpjs(),await this.fetchFinancials(),this.isLoaded=!0},methods:{async fetchUsers(){try{const e=await f.A.get(`/user/${this.userIdentify}`);this.user=e.data}catch(e){console.error("Error fetching users",e)}},async fetchCnpjs(){try{const e=await f.A.get("/branch");this.branches=e.data,this.branche=e.data.reduce(((e,a)=>(e[a._id]=a,e)),{})}catch(e){console.error("Error fetching branches ",e)}},async fetchCompanies(){const e=await f.A.get("/company");this.companies=e.data.reduce(((e,a)=>(e[a._id]=a,e)),{})},async fetchFinancials(){try{const e=await f.A.get("/financial/");this.financials=e.data,this.financials=this.financials.filter((e=>this.user.financials.includes(e._id))),this.filteredFinancials=this.financials}catch(e){console.error("Error fetching financials",e)}},async handlerFilteringFinancials(){await this.fetchUsers(),await this.fetchCompanies(),await this.fetchCnpjs(),this.fetchFinancials()},formatDate(e){return e?new Date(e).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}):""},openModal(e){this.idFinancial=e?e._id:"",this.isModalVisible=!0},closeModal(){this.isModalVisible=!1},onConfirm(e){this.isModalVisible=!1,this.$emit("onConfirm",e)},deleteItem(e){this.idFinancial=e._id,this.isDeleteModalVisible=!0},formatCurrency(e){if(!e||isNaN(parseFloat(e)))return"";const a=parseFloat(e);return"$"+a.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")},getTypeById(e){return this.typeFinancial.find((a=>a.id===e))?.name},categoryNameById(e){return Object.entries(this.categoryFinancial).filter((([a,i])=>i===e)).map((([e,a])=>e)).join("")||""},exportToPDF(){const e=new R["default"]("p","pt","a4"),a=[{title:"Category",dataKey:"category"},{title:"Type",dataKey:"type"},{title:"Date",dataKey:"date"},{title:"Amount",dataKey:"amount"},{title:"Description",dataKey:"description"}],i=this.filteredFinancials.map((e=>({category:e.category,type:e.type,amount:this.formatCurrency(e.amount.toString()),date:this.formatDate(e.date),description:e.description})));e.autoTable({head:[a.map((e=>e.title))],body:i.map((e=>a.map((a=>e[a.dataKey])))),startY:40,styles:{overflow:"linebreak"},columnStyles:{0:{cellWidth:80},1:{cellWidth:80},2:{cellWidth:100},3:{cellWidth:80},4:{cellWidth:150}},margin:{top:60}}),e.save("Financial.pdf")},exportToExcel(){const e=this.filteredFinancials.map((e=>({Company:this.companies[this.branche[e.branch_id].company_id].name,Branche:this.branche[e.branch_id]?.name,Category:this.categoryNameById(e.category),Type:this.getTypeById(e.type),Date:this.formatDate(e.date),Amount:this.formatCurrency(e.amount.toString()),Description:e.description}))),a=z.Wp.json_to_sheet(e),i=z.Wp.book_new();z.Wp.book_append_sheet(i,a,"Financial"),z._h(i,"Financial.xlsx")},filterFinancials(){const e=this.searchText.toLowerCase();this.filteredFinancials=this.financials.filter((a=>{const i=this.companies[this.branche[a.branch_id].company_id]?.name.toLowerCase()||"",t=this.branche[a.branch_id]?.name.toLowerCase()||"",n=this.categoryNameById(a.category)?.toLowerCase()||"",l=this.getTypeById(a.type)?.toLowerCase()||"",s=a.date?.toLowerCase()||"",c=a.amount?.toString()||"";return i.includes(e)||t.includes(e)||n.includes(e)||l.includes(e)||s.includes(e)||c.includes(e)}))}}});const H=(0,G.A)(Y,[["render",m],["__scopeId","data-v-e3b47e18"]]);var J=H}}]);
//# sourceMappingURL=283.6a6b2df3.js.map