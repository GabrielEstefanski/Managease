"use strict";(self["webpackChunkweb_project"]=self["webpackChunkweb_project"]||[]).push([[385],{9385:function(e,s,t){t.r(s),t.d(s,{default:function(){return B}});var r=t(6768),a=t(4232);const o={class:"container"},l={class:"flex gap-3 mt-4"},n={for:"name"},i={class:"flex gap-3 mt-4"},d={for:"password"},u={class:"flex gap-3 mt-4"},c={for:"new-password"},m={class:"flex gap-3 mt-4"},_={for:"confirm-password"},p={key:0,class:"flex gap-3 mt-4"};function g(e,s,t,g,b,f){const w=(0,r.g2)("InputText"),h=(0,r.g2)("FloatLabel"),v=(0,r.g2)("ConfirmDialog"),k=(0,r.g2)("Button"),y=(0,r.g2)("AccordionTab"),C=(0,r.g2)("Password"),P=(0,r.g2)("InlineMessage"),U=(0,r.g2)("Accordion"),F=(0,r.g2)("DeleteUserModal"),V=(0,r.g2)("Toast");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.Lk)("div",o,[(0,r.Lk)("h1",null,(0,a.v_)(e.$t("settings_page.title")),1),(0,r.bF)(U,{style:{width:"100%"}},{default:(0,r.k6)((()=>[(0,r.bF)(y,{header:e.$t("settings_page.accordion_title_change_your_name")},{default:(0,r.k6)((()=>[(0,r.Lk)("div",l,[(0,r.bF)(h,null,{default:(0,r.k6)((()=>[(0,r.bF)(w,{id:"name",modelValue:e.user.name,"onUpdate:modelValue":s[0]||(s[0]=s=>e.user.name=s),style:{width:"13rem"}},null,8,["modelValue"]),(0,r.Lk)("label",n,(0,a.v_)(e.$t("settings_page.label_name")),1)])),_:1})]),(0,r.bF)(v),(0,r.bF)(k,{class:"mt-4",style:{width:"13rem","justify-content":"center"},onClick:s[1]||(s[1]=s=>e.confirmSetUser(e.user.name))},{default:(0,r.k6)((()=>[(0,r.eW)((0,a.v_)(e.$t("settings_page.button_change_your_name")),1)])),_:1})])),_:1},8,["header"]),(0,r.bF)(y,{header:e.$t("settings_page.accordion_title_change_your_password")},{default:(0,r.k6)((()=>[(0,r.Lk)("div",i,[(0,r.bF)(h,null,{default:(0,r.k6)((()=>[(0,r.bF)(C,{"toggle-mask":"",feedback:!1,modelValue:e.currentPassword,"onUpdate:modelValue":s[2]||(s[2]=s=>e.currentPassword=s),invalid:!!e.errorCurrentPassword},null,8,["modelValue","invalid"]),(0,r.Lk)("label",d,(0,a.v_)(e.$t("settings_page.input_text_current_password")),1)])),_:1})]),(0,r.Lk)("div",u,[(0,r.bF)(h,null,{default:(0,r.k6)((()=>[(0,r.bF)(C,{"toggle-mask":"",feedback:!1,modelValue:e.user.password,"onUpdate:modelValue":s[3]||(s[3]=s=>e.user.password=s)},null,8,["modelValue"]),(0,r.Lk)("label",c,(0,a.v_)(e.$t("settings_page.input_text_new_password")),1)])),_:1})]),(0,r.Lk)("div",m,[(0,r.bF)(h,null,{default:(0,r.k6)((()=>[(0,r.bF)(C,{"toggle-mask":"",feedback:!1,modelValue:e.confirmPassword,"onUpdate:modelValue":s[4]||(s[4]=s=>e.confirmPassword=s),invalid:!!e.errorConfirmPassword},null,8,["modelValue","invalid"]),(0,r.Lk)("label",_,(0,a.v_)(e.$t("settings_page.input_text_confirm_password")),1)])),_:1})]),e.errorCurrentPassword||e.errorConfirmPassword?((0,r.uX)(),(0,r.CE)("div",p,[(0,r.bF)(P,{severity:"error",style:{width:"14rem"}},{default:(0,r.k6)((()=>[(0,r.eW)((0,a.v_)(e.errorCurrentPassword)+(0,a.v_)(e.errorConfirmPassword),1)])),_:1})])):(0,r.Q3)("",!0),(0,r.bF)(k,{class:"mt-4",style:{width:"14rem","justify-content":"center"},onClick:e.handlerChangePassword},{default:(0,r.k6)((()=>[(0,r.eW)((0,a.v_)(e.$t("settings_page.button_change_your_password")),1)])),_:1},8,["onClick"])])),_:1},8,["header"]),(0,r.bF)(y,{header:e.$t("settings_page.accordion_title_delete_your_account")},{default:(0,r.k6)((()=>[(0,r.bF)(k,{severity:"danger",style:{width:"14rem","justify-content":"center"},onClick:e.openDeleteUserModal,outlined:""},{default:(0,r.k6)((()=>[(0,r.eW)((0,a.v_)(e.$t("settings_page.button_confirm_delete")),1)])),_:1},8,["onClick"])])),_:1},8,["header"])])),_:1})]),e.isModalVisible?((0,r.uX)(),(0,r.Wv)(F,{key:0,visible:e.isModalVisible,"onUpdate:visible":s[5]||(s[5]=s=>e.isModalVisible=s)},null,8,["visible"])):(0,r.Q3)("",!0),(0,r.bF)(V)],64)}t(4114);var b=t(9361),f=t(6056),w={root:"p-float-label"},h=f.A.extend({name:"floatlabel",classes:w}),v={name:"BaseFloatLabel",extends:b.A,props:{},style:h,provide:function(){return{$parentInstance:this}}},k={name:"FloatLabel",extends:v,inheritAttrs:!1};function y(e,s,t,a,o,l){return(0,r.uX)(),(0,r.CE)("span",(0,r.v6)({class:e.cx("root")},e.ptmi("root")),[(0,r.RG)(e.$slots,"default")],16)}k.render=y;var C=t(1459),P=t(1357);const U={class:"column gap-2 mb-3"},F={for:"username"},V={class:"column gap-2 mb-3"},$={for:"password"};function L(e,s,t,o,l,n){const i=(0,r.g2)("InputText"),d=(0,r.g2)("Password"),u=(0,r.g2)("InlineMessage"),c=(0,r.g2)("Button"),m=(0,r.g2)("Dialog");return(0,r.uX)(),(0,r.Wv)(m,{visible:e.innerVisible,"onUpdate:visible":s[2]||(s[2]=s=>e.innerVisible=s),modal:!0,header:e.title,style:{width:"90%",maxWidth:"25rem"}},{footer:(0,r.k6)((()=>[(0,r.bF)(c,{label:e.$t("user_delete_modal.button_cancel"),severity:"secondary",class:"p-button-text p-button-outlined",onClick:e.onCancel},null,8,["label","onClick"]),e.logged?((0,r.uX)(),(0,r.Wv)(c,{key:1,severity:"danger",label:e.$t("user_delete_modal.button_delete"),onClick:e.deleteUser},null,8,["label","onClick"])):((0,r.uX)(),(0,r.Wv)(c,{key:0,severity:"primary",label:e.$t("user_delete_modal.button_confirm"),onClick:e.findUser},null,8,["label","onClick"]))])),default:(0,r.k6)((()=>[e.logged?((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.eW)((0,a.v_)(e.$t("user_delete_modal.message")),1)],64)):((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[(0,r.Lk)("div",U,[(0,r.Lk)("label",F,(0,a.v_)(e.$t("user_delete_modal.login_username")),1),(0,r.bF)(i,{id:"username",modelValue:e.username,"onUpdate:modelValue":s[0]||(s[0]=s=>e.username=s)},null,8,["modelValue"])]),(0,r.Lk)("div",V,[(0,r.Lk)("label",$,(0,a.v_)(e.$t("user_delete_modal.login_password")),1),(0,r.bF)(d,{id:"password",modelValue:e.password,"onUpdate:modelValue":s[1]||(s[1]=s=>e.password=s),feedback:!1,inputStyle:{width:"100%"},toggleMask:""},null,8,["modelValue"])]),e.error?((0,r.uX)(),(0,r.Wv)(u,{key:0,severity:"error"},{default:(0,r.k6)((()=>[(0,r.eW)((0,a.v_)(e.error),1)])),_:1})):(0,r.Q3)("",!0)],64))])),_:1},8,["visible","header"])}var x=t(144),I=t(1387),A=t(782),M=t(5384),W=(0,r.pM)({name:"DeleteModal",props:{visible:Boolean},data(){return{}},setup(){const e=(0,x.KR)([]),s=(0,x.KR)(""),t=(0,x.KR)(""),r=(0,x.KR)(""),a=(0,x.KR)(!1),{t:o}=(0,M.s9)(),l=(0,x.KR)("Login"),n=(0,A.Pj)(),i=(0,I.rd)(),d=n.state.userId,u=async()=>{try{await c();const r=e.value.find((e=>e.username===s.value))??null;await P.A.post("/login",{_id:r?._id,password:t.value}),a.value=!0,l.value=o("user_delete_modal.header")}catch(n){r.value="Invalid username or password",console.error("Error logging in",r)}},c=async()=>{try{const s=await P.A.get("/user");e.value=s.data}catch(r){console.error("Error fetching users",r)}};async function m(){try{await P.A.delete(`/user/${d}`),n.commit("setUser",{id:null,name:null}),i.push("/")}catch(r){console.error("Error updating user",r)}}return{password:t,username:s,userId:d,title:l,error:r,deleteUser:m,logged:a,findUser:u}},computed:{innerVisible:{get(){return this.visible},set(e){e||this.$emit("update:visible",e)}}},methods:{onCancel(){this.innerVisible=!1},async onSave(){await this.deleteUser(),this.innerVisible=!1}}}),j=t(1241);const E=(0,j.A)(W,[["render",L],["__scopeId","data-v-3007e94b"]]);var X=E,K=t(2151),D=t(141),R=(0,r.pM)({name:"SettingsPage",components:{DeleteUserModal:X,FloatLabel:k},data(){return{user:{},isModalVisible:!1,errorCurrentPassword:"",errorConfirmPassword:"",userId:"",currentPassword:"",confirmPassword:"",messageUpdateUser:""}},setup(){const e=(0,A.Pj)(),s=(0,K.d)(),t=(0,D.S)(),r=e.state.userId,{t:a}=(0,M.s9)(),o=async t=>{try{await P.A.put(`/user/${r}`,{name:t}),s.add({severity:"success",summary:a("toast_success.summary_user_updated"),detail:a("toast_success.detail_user_updated"),life:3e3}),e.commit("setUser",{id:r,name:t})}catch(o){console.error("Error updating user",o),s.add({severity:"error",summary:a("toast_error.summary"),detail:a("toast_error.detail_user_update"),life:3e3})}},l=()=>{s.add({severity:"success",summary:a("toast_success.summary_password_updated"),detail:a("toast_success.detail_user_updated"),life:3e3})},n=e=>{t.require({message:a("confirmation_modal.message"),header:a("confirmation_modal.header"),icon:"pi pi-exclamation-circle",rejectClass:"p-button-secondary p-button-outlined",rejectLabel:a("confirmation_modal.rejectLabel"),acceptClass:"p-button-success",acceptLabel:a("confirmation_modal.acceptLabel"),accept:()=>{o(e)}})};function i(){e.commit("setUser",{id:null,name:null}),C.A.push("/")}return{logout:i,confirmSetUser:n,toastUpdatedPassword:l}},created(){const e=(0,A.Pj)(),s=e.state.userId,t=e.state.userName;s||t||C.A.push("/"),this.userId=s,this.user.name=t},methods:{async loginUser(){try{await P.A.post("/login",{_id:this.userId,password:this.currentPassword}),await this.confirmUserName()}catch(e){this.errorCurrentPassword=this.$t("settings_page.error_current_password"),console.error("Error in confirm password",e)}},async updateUser(){try{await P.A.put(`/user/${this.userId}`,this.user)}catch(e){console.error("Error updating user",e)}},async handlerChangePassword(){this.errorCurrentPassword="",this.errorConfirmPassword="",await this.loginUser()},async confirmUserName(){this.user.password===this.confirmPassword?(await this.updateUser(),this.toastUpdatedPassword(),this.errorCurrentPassword="",this.errorConfirmPassword=""):this.errorConfirmPassword=this.$t("settings_page.error_match_password")},openDeleteUserModal(){this.isModalVisible=!0}}});const S=(0,j.A)(R,[["render",g],["__scopeId","data-v-43ae476c"]]);var B=S}}]);
//# sourceMappingURL=385.80af8ccd.js.map