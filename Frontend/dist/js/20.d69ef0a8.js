"use strict";(self["webpackChunkweb_project"]=self["webpackChunkweb_project"]||[]).push([[20],{9326:function(e,a,i){i.r(a),i.d(a,{default:function(){return G}});var t=i(6768),n=i(4232);const l=e=>((0,t.Qi)("data-v-51a22573"),e=e(),(0,t.jt)(),e),s={class:"container"},r={class:"table"},c={class:"title"},o=l((()=>(0,t.Lk)("div",{class:"spinner-container"},[(0,t.Lk)("i",{class:"pi pi-spin pi-spinner large-spinner"})],-1))),d={class:"title"},h=l((()=>(0,t.Lk)("i",{class:"pi pi-search"},null,-1))),y={class:"dataTable"},p={class:"p-d-flex p-jc-end p-ai-center"};function u(e,a,i,l,u,f){const _=(0,t.g2)("Button"),m=(0,t.g2)("InputText"),g=(0,t.g2)("InputGroupAddon"),b=(0,t.g2)("InputGroup"),F=(0,t.g2)("Toolbar"),v=(0,t.g2)("Column"),k=(0,t.g2)("DataTable"),$=(0,t.g2)("DeleteModal"),C=(0,t.g2)("FinancialModal");return(0,t.uX)(),(0,t.CE)(t.FK,null,[(0,t.Lk)("div",s,[(0,t.Lk)("div",r,[e.isLoaded?((0,t.uX)(),(0,t.CE)(t.FK,{key:1},[(0,t.Lk)("h1",d,(0,n.v_)(e.branch.name),1),(0,t.bF)(F,null,{start:(0,t.k6)((()=>[(0,t.bF)(_,{icon:"pi pi-file-excel",class:"mr-2",severity:"secondary",onClick:e.exportToExcel},null,8,["onClick"]),(0,t.bF)(_,{icon:"pi pi-print",severity:"secondary",onClick:e.exportToPDF},null,8,["onClick"])])),center:(0,t.k6)((()=>[(0,t.bF)(b,null,{default:(0,t.k6)((()=>[(0,t.bF)(m,{icon:"pi pi-search",modelValue:e.searchText,"onUpdate:modelValue":a[0]||(a[0]=a=>e.searchText=a),placeholder:e.$t("financials_page.search_bar"),style:{width:"30vw"},onInput:e.filterFinancials,rounded:""},null,8,["modelValue","placeholder","onInput"]),(0,t.bF)(g,null,{default:(0,t.k6)((()=>[h])),_:1})])),_:1})])),end:(0,t.k6)((()=>[(0,t.bF)(_,{label:e.$t("financials_page.button_add_financial"),onClick:a[1]||(a[1]=a=>e.openModal())},null,8,["label"])])),_:1}),(0,t.Lk)("div",y,[(0,t.bF)(k,{value:e.filteredFinancials,ref:"tableRef",paginator:!0,rows:10,tableStyle:"width: 100%;"},{empty:(0,t.k6)((()=>[(0,t.eW)(" No financials found. ")])),default:(0,t.k6)((()=>[(0,t.bF)(v,{field:"type",header:e.$t("financials_page.table_column_type"),sortable:"",style:{width:"15%"}},{body:(0,t.k6)((({data:a})=>[(0,t.Lk)("div",null,(0,n.v_)(e.getTypeById(a.type)),1)])),_:1},8,["header"]),(0,t.bF)(v,{field:"category",header:e.$t("financials_page.table_column_category"),sortable:"",style:{width:"15%"}},{body:(0,t.k6)((({data:a})=>[(0,t.Lk)("div",null,(0,n.v_)(e.categoryNameById(a.category)),1)])),_:1},8,["header"]),(0,t.bF)(v,{field:"date",header:e.$t("financials_page.table_column_date"),sortable:"",style:{width:"15%"}},{body:(0,t.k6)((({data:a})=>[(0,t.Lk)("data",null,(0,n.v_)(e.formatDate(a.date)),1)])),_:1},8,["header"]),(0,t.bF)(v,{field:"amount",header:e.$t("financials_page.table_column_amount"),sortable:"",style:{width:"10%"}},{body:(0,t.k6)((({data:a})=>[(0,t.Lk)("div",null,(0,n.v_)(e.formatCurrency(a.amount)),1)])),_:1},8,["header"]),(0,t.bF)(v,{field:"actions",header:e.$t("financials_page.table_column_actions"),style:{width:"5%"}},{body:(0,t.k6)((({data:a})=>[(0,t.Lk)("div",p,[(0,t.bF)(_,{icon:"pi pi-pencil",class:"mr-2 mb-2",severity:"success",rounded:"",onClick:i=>e.openModal(a)},null,8,["onClick"]),(0,t.bF)(_,{icon:"pi pi-times",class:"mb-2",severity:"danger",rounded:"",onClick:i=>e.deleteItem(a)},null,8,["onClick"])])])),_:1},8,["header"])])),_:1},8,["value"])])],64)):((0,t.uX)(),(0,t.CE)(t.FK,{key:0},[(0,t.Lk)("h1",c,(0,n.v_)(e.$t("financials_page.title")),1),o],64))])]),e.isDeleteModalVisible?((0,t.uX)(),(0,t.Wv)($,{key:0,visible:e.isDeleteModalVisible,"onUpdate:visible":a[2]||(a[2]=a=>e.isDeleteModalVisible=a),id:e.idFinancial,items:"financial",onItemDeleted:e.handlerFilteringFinancials},null,8,["visible","id","onItemDeleted"])):(0,t.Q3)("",!0),e.isModalVisible?((0,t.uX)(),(0,t.Wv)(C,{key:1,visible:e.isModalVisible,"onUpdate:visible":a[3]||(a[3]=a=>e.isModalVisible=a),id:e.idFinancial,idBranche:e.idBranch,onFinancialUpdated:e.handlerFilteringFinancials},null,8,["visible","id","idBranche","onFinancialUpdated"])):(0,t.Q3)("",!0)],64)}i(4114);var f=i(1357),_=i(8797);const m=e=>((0,t.Qi)("data-v-273486aa"),e=e(),(0,t.jt)(),e),g={class:"flex-container"},b={class:"flex-item"},F={class:"column gap-2 mb-3"},v={for:"branche"},k={class:"column gap-2 mb-3"},$={for:"type"},C={class:"column gap-2 mb-3"},w={for:"category"},I={class:"flex-item"},L={class:"column gap-2 mb-3"},T={for:"date"},V={class:"column gap-2 mb-3"},B={for:"amount"},D=m((()=>(0,t.Lk)("i",{class:"pi pi-dollar"},null,-1))),x={class:"column gap-2 mb-3"},M={for:"description"};function S(e,a,i,l,s,r){const c=(0,t.g2)("InputText"),o=(0,t.g2)("Dropdown"),d=(0,t.g2)("Calendar"),h=(0,t.g2)("InputNumber"),y=(0,t.g2)("InputGroupAddon"),p=(0,t.g2)("InputGroup"),u=(0,t.g2)("Textarea"),f=(0,t.g2)("Button"),_=(0,t.g2)("Dialog");return(0,t.uX)(),(0,t.Wv)(_,{visible:e.innerVisible,"onUpdate:visible":a[6]||(a[6]=a=>e.innerVisible=a),modal:!0,header:e.labelTitle,style:{width:"90%",maxWidth:"50rem"}},{footer:(0,t.k6)((()=>[(0,t.bF)(f,{label:"Cancel",severity:"secondary",onClick:e.onCancel},null,8,["onClick"]),(0,t.bF)(f,{icon:"pi pi-check",severity:"success",label:"Save",onClick:e.onSave},null,8,["onClick"])])),default:(0,t.k6)((()=>[(0,t.Lk)("div",g,[(0,t.Lk)("div",b,[(0,t.Lk)("div",F,[(0,t.Lk)("label",v,(0,n.v_)(e.$t("financials_modal.label_branch")),1),(0,t.bF)(c,{id:"branche",modelValue:e.selectedBranche,"onUpdate:modelValue":a[0]||(a[0]=a=>e.selectedBranche=a),disabled:""},null,8,["modelValue"])]),(0,t.Lk)("div",k,[(0,t.Lk)("label",$,(0,n.v_)(e.$t("financials_modal.label_type")),1),(0,t.bF)(o,{id:"type",modelValue:e.selectedType,"onUpdate:modelValue":a[1]||(a[1]=a=>e.selectedType=a),options:e.typeFinancial,onChange:e.onTypeChange,optionLabel:"name"},{option:(0,t.k6)((({option:e})=>[(0,t.eW)((0,n.v_)(e.name),1)])),_:1},8,["modelValue","options","onChange"])]),(0,t.Lk)("div",C,[(0,t.Lk)("label",w,(0,n.v_)(e.$t("financials_modal.label_category")),1),(0,t.bF)(o,{id:"category",modelValue:e.selectedCategory,"onUpdate:modelValue":a[2]||(a[2]=a=>e.selectedCategory=a),options:e.getCategoryForType(e.selectedType.name),onChange:e.getIdCategory,optionLabel:"name"},{option:(0,t.k6)((({option:e})=>[(0,t.eW)((0,n.v_)(e.name),1)])),_:1},8,["modelValue","options","onChange"])])]),(0,t.Lk)("div",I,[(0,t.Lk)("div",L,[(0,t.Lk)("label",T,(0,n.v_)(e.$t("financials_modal.label_date")),1),(0,t.bF)(d,{id:"date",modelValue:e.dateFinancial,"onUpdate:modelValue":a[3]||(a[3]=a=>e.dateFinancial=a),showIcon:"",iconDisplay:"input"},null,8,["modelValue"])]),(0,t.Lk)("div",V,[(0,t.Lk)("label",B,(0,n.v_)(e.$t("financials_modal.label_amount")),1),(0,t.bF)(p,null,{default:(0,t.k6)((()=>[(0,t.bF)(h,{id:"amount",modelValue:e.financial.amount,"onUpdate:modelValue":a[4]||(a[4]=a=>e.financial.amount=a),inputId:"currency-us",mode:"currency",currency:"USD",locale:"en-US"},null,8,["modelValue"]),(0,t.bF)(y,null,{default:(0,t.k6)((()=>[D])),_:1})])),_:1})]),(0,t.Lk)("div",x,[(0,t.Lk)("label",M,(0,n.v_)(e.$t("financials_modal.label_description")),1),(0,t.bF)(u,{id:"description",modelValue:e.financial.description,"onUpdate:modelValue":a[5]||(a[5]=a=>e.financial.description=a),autoResize:"",rows:"5",cols:"30"},null,8,["modelValue"])])])])])),_:1},8,["visible","header"])}var A=i(1459),U=i(782),W=(0,t.pM)({name:"FinancialModal",props:{id:String,idBranche:String,visible:Boolean},data(){return{financial:{},user:{},branche:{},branches:[],labelTitle:this.$t("financials_modal.title_add"),dateFinancial:new Date,selectedType:{id:0,name:""},selectedCategory:{id:0,name:""},userIdentify:"",userNameIdentify:"",selectedBranche:"",typeFinancial:[{id:1,name:this.$t("array_type_fiancial.revenue")},{id:2,name:this.$t("array_type_fiancial.expense")}],categoryFinancial:{[this.$t("array_type_fiancial.revenue")]:{[this.$t("array_category_financial.product_sales")]:1,[this.$t("array_category_financial.services_rendered")]:2,[this.$t("array_category_financial.commissions")]:3,[this.$t("array_category_financial.property_rent")]:4,[this.$t("array_category_financial.investments")]:5,[this.$t("array_category_financial.others_revenues")]:6},[this.$t("array_type_fiancial.expense")]:{[this.$t("array_category_financial.salaries_benefits")]:7,[this.$t("array_category_financial.rent")]:8,[this.$t("array_category_financial.raw_materials")]:9,[this.$t("array_category_financial.maintenance")]:10,[this.$t("array_category_financial.taxes_fees")]:11,[this.$t("array_category_financial.others_expense")]:12}}}},created(){const e=(0,U.Pj)(),a=e.state.userId,i=e.state.userName;a||i||A.A.push("/"),this.userIdentify=a,this.userNameIdentify=i},computed:{innerVisible:{get(){return this.visible},set(e){e||this.$emit("update:visible",e)}}},async mounted(){await this.fetchUsers(),await this.fetchBranches(),""!==this.id&&(await this.fetchFinancial(),this.labelTitle=this.$t("branches_modal.title_edit"))},methods:{async fetchUsers(){try{const e=await f.A.get(`/user/${this.userIdentify}`);this.user=e.data}catch(e){console.error("Error fetching user",e)}},async fetchAllBranches(){try{const e=await f.A.get("/branch");this.branches=e.data}catch(e){console.error("Error fetching cnpjs ",e)}},async fetchBranches(){try{const e=await f.A.get(`/branch/${this.idBranche}`);this.branche=e.data,this.selectedBranche=this.branche.name}catch(e){console.error("Error fetching branches ",e)}},async fetchFinancial(){try{const e=await f.A.get(`/financial/${this.id}`);this.financial=e.data,this.selectedType.id=this.financial.type,this.getTypeById(this.selectedType.id),this.getCategoryById(this.financial.category),this.dateFinancial=new Date(this.financial.date)}catch(e){console.error("Error fetching financials",e)}},async postFinancial(){try{this.financial.branch_id=this.branche._id,this.financial.date=this.dateFinancial.toISOString();const e=await f.A.post("/financial",this.financial),a=e.data.financial._id;this.user.financials.push(a),await f.A.put(`/user/${this.userIdentify}`,this.user)}catch(e){console.error("Error posting financial",e)}},async putFinancial(){try{this.financial.date=this.dateFinancial.toISOString(),await f.A.put(`/financial/${this.id}`,this.financial)}catch(e){console.error("Error posting company",e)}},async onSave(){""!==this.id?await this.putFinancial():await this.postFinancial(),this.innerVisible=!1,this.$emit("financialUpdated")},getTypeById(e){const a=this.typeFinancial.find((a=>a.id===e));a&&(this.selectedType=a)},getCategoryById(e){const a=Object.values(this.categoryFinancial).reduce(((e,a)=>({...e,...a})),{}),i=Object.entries(a).find((([a,i])=>i===e));if(i){const[e,a]=i;this.selectedCategory={id:a,name:e}}else this.selectedCategory={id:0,name:""}},getIdCategory(){this.financial.category=this.selectedCategory.id||0},onTypeChange(){this.financial.type=this.selectedType.id},getCategoryForType(e){const a=this.categoryFinancial[e];return a?Object.entries(a).map((([e,a])=>({id:a,name:e}))):[]},formatDate(e){return e?new Date(e).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}):""},onCancel(){this.innerVisible=!1}}}),j=i(1241);const E=(0,j.A)(W,[["render",S],["__scopeId","data-v-273486aa"]]);var N=E,K=i(1749),O=(i(5839),i(3230)),X=(0,t.pM)({name:"FinancialPage",props:{idBranch:{type:String,required:!0}},components:{FinancialModal:N,DeleteModal:_.A},data(){return{financials:[],filteredFinancials:[],branch:{},isDeleteModalVisible:!1,isModalVisible:!1,isLoaded:!1,id:"",idFinancial:"",searchText:"",typeFinancial:[{id:1,name:this.$t("array_type_fiancial.revenue")},{id:2,name:this.$t("array_type_fiancial.expense")}],categoryFinancial:{[this.$t("array_category_financial.product_sales")]:1,[this.$t("array_category_financial.services_rendered")]:2,[this.$t("array_category_financial.commissions")]:3,[this.$t("array_category_financial.property_rent")]:4,[this.$t("array_category_financial.investments")]:5,[this.$t("array_category_financial.others_revenues")]:6,[this.$t("array_category_financial.salaries_benefits")]:7,[this.$t("array_category_financial.rent")]:8,[this.$t("array_category_financial.raw_materials")]:9,[this.$t("array_category_financial.maintenance")]:10,[this.$t("array_category_financial.taxes_fees")]:11,[this.$t("array_category_financial.others_expense")]:12}}},created(){const e=(0,U.Pj)(),a=e.state.userId,i=e.state.userName;a||i||A.A.push("/")},async mounted(){await this.fetchBranches(),await this.fetchFinancials(),this.isLoaded=!0},methods:{async fetchBranches(){try{const e=await f.A.get(`/branch/${this.idBranch}`);this.branch=e.data}catch(e){console.error("Error fetching branches ",e)}},async fetchFinancials(){try{const e=await f.A.get("/financial/");this.financials=e.data,this.financials=this.financials.filter((e=>this.branch._id===e.branch_id)),this.financials=this.financials.map((e=>({...e,date:this.formatDate(e.date)}))),this.filteredFinancials=this.financials}catch(e){console.error("Error fetching financials",e)}},async handlerFilteringFinancials(){await this.fetchBranches(),this.fetchFinancials()},formatDate(e){return e?new Date(e).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}):""},openModal(e){this.idFinancial=e?e._id:"",this.isModalVisible=!0},formatCurrency(e){if(!e||isNaN(parseFloat(e)))return"";const a=parseFloat(e);return"$"+a.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")},closeModal(){this.isModalVisible=!1},onConfirm(e){this.isModalVisible=!1,this.$emit("onConfirm",e)},deleteItem(e){this.idFinancial=e._id,this.isDeleteModalVisible=!0},getTypeById(e){return this.typeFinancial.find((a=>a.id===e))?.name},categoryNameById(e){return Object.entries(this.categoryFinancial).filter((([a,i])=>i===e)).map((([e,a])=>e)).join("")||""},exportToPDF(){const e=new K["default"]("p","pt","a4"),a=[{title:"Category",dataKey:"category"},{title:"Type",dataKey:"type"},{title:"Date",dataKey:"date"},{title:"Amount",dataKey:"amount"},{title:"Description",dataKey:"description"}],i=this.filteredFinancials.map((e=>({category:this.categoryNameById(e.category),type:this.getTypeById(e.type),amount:this.formatCurrency(e.amount.toString()),date:e.date,description:e.description})));e.autoTable({head:[a.map((e=>e.title))],body:i.map((e=>a.map((a=>e[a.dataKey])))),startY:40,styles:{overflow:"linebreak"},columnStyles:{0:{cellWidth:100},1:{cellWidth:80},2:{cellWidth:100},3:{cellWidth:80},4:{cellWidth:150}},margin:{top:60}}),e.save("Financial.pdf")},exportToExcel(){const e=this.filteredFinancials.map((e=>({Category:this.categoryNameById(e.category),Type:this.getTypeById(e.type),Date:this.formatDate(e.date),Amount:this.formatCurrency(e.amount.toString()),Description:e.description}))),a=O.Wp.json_to_sheet(e),i=O.Wp.book_new();O.Wp.book_append_sheet(i,a,"Financial"),O._h(i,"Financial.xlsx")},filterFinancials(){const e=this.searchText.toLowerCase();this.filteredFinancials=this.financials.filter((a=>{const i=this.categoryNameById(a.category)?.toLowerCase()||"",t=this.getTypeById(a.type)?.toLowerCase()||"",n=a.date?.toLowerCase()||"",l=a.amount?.toString()||"";return i.includes(e)||t.includes(e)||n.includes(e)||l.includes(e)}))}}});const P=(0,j.A)(X,[["render",u],["__scopeId","data-v-51a22573"]]);var G=P}}]);
//# sourceMappingURL=20.d69ef0a8.js.map