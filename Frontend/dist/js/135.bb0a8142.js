"use strict";(self["webpackChunkweb_project"]=self["webpackChunkweb_project"]||[]).push([[135],{5693:function(e,t,a){a.r(t),a.d(t,{default:function(){return B}});var i=a(6768),s=a(4232);const o=e=>((0,i.Qi)("data-v-0fa16ce0"),e=e(),(0,i.jt)(),e),l={class:"container"},n={class:"table"},c={class:"title"},r={key:0,class:"spinner-container"},d=o((()=>(0,i.Lk)("i",{class:"pi pi-spin pi-spinner large-spinner"},null,-1))),p=[d],u=o((()=>(0,i.Lk)("i",{class:"pi pi-search"},null,-1))),m={class:"dataTable",ref:"tableRef"},h={class:"p-d-flex p-jc-end p-ai-center"};function y(e,t,a,o,d,y){const b=(0,i.g2)("Button"),v=(0,i.g2)("InputText"),_=(0,i.g2)("InputGroupAddon"),f=(0,i.g2)("InputGroup"),C=(0,i.g2)("Toolbar"),g=(0,i.g2)("Column"),k=(0,i.g2)("DataTable"),w=(0,i.g2)("DeleteModal"),F=(0,i.g2)("CompanyModal");return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.Lk)("div",l,[(0,i.Lk)("div",n,[(0,i.Lk)("h1",c,(0,s.v_)(e.$t("companies_page.title")),1),e.isLoaded?((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.bF)(C,null,{start:(0,i.k6)((()=>[(0,i.bF)(b,{icon:"pi pi-file-excel",class:"mr-2",severity:"secondary",onClick:e.exportToExcel},null,8,["onClick"]),(0,i.bF)(b,{icon:"pi pi-print",severity:"secondary",onClick:e.exportToPDF},null,8,["onClick"])])),center:(0,i.k6)((()=>[(0,i.bF)(f,null,{default:(0,i.k6)((()=>[(0,i.bF)(v,{icon:"pi pi-search",modelValue:e.searchText,"onUpdate:modelValue":t[0]||(t[0]=t=>e.searchText=t),placeholder:e.$t("companies_page.search_bar"),style:{width:"30vw"},onInput:e.filterCompanies,rounded:""},null,8,["modelValue","placeholder","onInput"]),(0,i.bF)(_,null,{default:(0,i.k6)((()=>[u])),_:1})])),_:1})])),end:(0,i.k6)((()=>[(0,i.bF)(b,{class:"button-add",label:e.$t("companies_page.button_add_company"),onClick:t[1]||(t[1]=t=>e.openModal())},null,8,["label"])])),_:1}),(0,i.Lk)("div",m,[(0,i.bF)(k,{value:e.filteredCompanies,paginator:!0,rows:10,tableStyle:"width: 100%"},{empty:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(e.$t("companies_page.empty_table")),1)])),default:(0,i.k6)((()=>[(0,i.bF)(g,{field:"name",filterField:"name",header:e.$t("companies_page.table_column_name"),sortable:"",style:{width:"25%"}},null,8,["header"]),(0,i.bF)(g,{field:"sector",header:e.$t("companies_page.table_column_sector"),sortable:"",style:{width:"20%"}},null,8,["header"]),(0,i.bF)(g,{field:"valuation",header:e.$t("companies_page.table_column_valuation"),sortable:"",style:{width:"20%"}},{body:(0,i.k6)((({data:t})=>[(0,i.Lk)("div",null,(0,s.v_)(e.formatCurrency(t.valuation)),1)])),_:1},8,["header"]),(0,i.bF)(g,{field:"active",header:e.$t("companies_page.table_column_status"),sortable:"",style:{width:"10%"}},{body:(0,i.k6)((({data:e})=>[(0,i.Lk)("i",{class:(0,s.C4)(["pi",{"pi-check-circle text-green-500":1===e.active,"pi-times-circle text-red-400":0===e.active}])},null,2)])),_:1},8,["header"]),(0,i.bF)(g,{field:"actions",header:e.$t("companies_page.table_column_actions"),style:{width:"10%"}},{body:(0,i.k6)((({data:t})=>[(0,i.Lk)("div",h,[(0,i.bF)(b,{icon:"pi pi-pencil",class:"mb-2 mr-2",severity:"success",rounded:"",onClick:a=>e.openModal(t)},null,8,["onClick"]),(0,i.bF)(b,{icon:"pi pi-times",class:"mb-2 mr-2",severity:"danger",rounded:"",onClick:a=>e.deleteItem(t)},null,8,["onClick"]),(0,i.bF)(b,{icon:"pi pi-building",class:"mb-2",severity:"warning",rounded:"",style:{color:"white"},onClick:a=>e.goToBranche(t)},null,8,["onClick"])])])),_:1},8,["header"])])),_:1},8,["value"])],512)],64)):((0,i.uX)(),(0,i.CE)("div",r,p))])]),e.isDeleteModalVisible?((0,i.uX)(),(0,i.Wv)(w,{key:0,visible:e.isDeleteModalVisible,"onUpdate:visible":t[2]||(t[2]=t=>e.isDeleteModalVisible=t),id:e.idCompany,items:"company",onItemDeleted:e.handlerFilteringCompanies},null,8,["visible","id","onItemDeleted"])):(0,i.Q3)("",!0),e.isModalVisible?((0,i.uX)(),(0,i.Wv)(F,{key:1,visible:e.isModalVisible,"onUpdate:visible":t[3]||(t[3]=t=>e.isModalVisible=t),id:e.idCompany,onCompanyUpdated:e.handlerFilteringCompanies},null,8,["visible","id","onCompanyUpdated"])):(0,i.Q3)("",!0)],64)}a(4114);var b=a(1357);const v={class:"column gap-2 mb-3"},_={for:"name"},f={class:"column gap-2 mb-3"},C={for:"sector"},g={class:"column gap-2 mb-3"},k={for:"valuation"},w=(0,i.Lk)("i",{class:"pi pi-dollar"},null,-1),F={class:"flex flex-wrap mb-3"},V={for:"active",class:"mr-4"},I={for:"inactive",class:"ml-2"};function $(e,t,a,o,l,n){const c=(0,i.g2)("InputText"),r=(0,i.g2)("InputNumber"),d=(0,i.g2)("InputGroupAddon"),p=(0,i.g2)("InputGroup"),u=(0,i.g2)("RadioButton"),m=(0,i.g2)("Button"),h=(0,i.g2)("Toast"),y=(0,i.g2)("Dialog");return(0,i.uX)(),(0,i.Wv)(y,{visible:e.innerVisible,"onUpdate:visible":t[5]||(t[5]=t=>e.innerVisible=t),modal:!0,header:e.labelTitle,style:{width:"90%",maxWidth:"25rem"}},{footer:(0,i.k6)((()=>[(0,i.bF)(m,{label:"Cancel",severity:"secondary",onClick:e.onCancel},null,8,["onClick"]),(0,i.bF)(m,{icon:"pi pi-check",severity:"success",label:"Save",onClick:e.onSave},null,8,["onClick"])])),default:(0,i.k6)((()=>[(0,i.Lk)("div",v,[(0,i.Lk)("label",_,(0,s.v_)(e.$t("company_modal.label_company")),1),(0,i.bF)(c,{id:"name",modelValue:e.company.name,"onUpdate:modelValue":t[0]||(t[0]=t=>e.company.name=t)},null,8,["modelValue"])]),(0,i.Lk)("div",f,[(0,i.Lk)("label",C,(0,s.v_)(e.$t("company_modal.label_sector")),1),(0,i.bF)(c,{id:"sector",modelValue:e.company.sector,"onUpdate:modelValue":t[1]||(t[1]=t=>e.company.sector=t)},null,8,["modelValue"])]),(0,i.Lk)("div",g,[(0,i.Lk)("label",k,(0,s.v_)(e.$t("company_modal.label_valuation")),1),(0,i.bF)(p,null,{default:(0,i.k6)((()=>[(0,i.bF)(r,{id:"valuation",modelValue:e.company.valuation,"onUpdate:modelValue":t[2]||(t[2]=t=>e.company.valuation=t),inputId:"currency-us",mode:"currency",currency:"USD",locale:"en-US"},null,8,["modelValue"]),(0,i.bF)(d,null,{default:(0,i.k6)((()=>[w])),_:1})])),_:1})]),(0,i.Lk)("div",F,[(0,i.bF)(u,{modelValue:e.company.active,"onUpdate:modelValue":t[3]||(t[3]=t=>e.company.active=t),id:"active",class:"mr-2",name:"active",value:1},null,8,["modelValue"]),(0,i.Lk)("label",V,(0,s.v_)(e.$t("company_modal.radio_button_active")),1),(0,i.bF)(u,{modelValue:e.company.active,"onUpdate:modelValue":t[4]||(t[4]=t=>e.company.active=t),id:"inactive",class:"mr-2",name:"Inactive",value:0},null,8,["modelValue"]),(0,i.Lk)("label",I,(0,s.v_)(e.$t("company_modal.radio_button_inactive")),1)]),(0,i.bF)(h)])),_:1},8,["visible","header"])}var L=a(1459),D=a(2151),x=a(782),M=a(5384),T=(0,i.pM)({name:"ModalCard",props:{id:String,visible:Boolean},setup(){const e=(0,D.d)(),{t:t}=(0,M.s9)();function a(){e.add({severity:"error",summary:t("toast_error.summary"),detail:t("toast_error.detail_company_exists")})}return{showFailedToast:a}},data(){return{company:{},user:{},isDuplicate:!1,userIdentify:0,labelTitle:this.$t("company_modal.title_add"),userNameIdentify:""}},created(){const e=(0,x.Pj)(),t=e.state.userId,a=e.state.userName;t||a||L.A.push("/"),this.userIdentify=t,this.userNameIdentify=a},computed:{innerVisible:{get(){return this.visible},set(e){e||this.$emit("update:visible",e)}}},async mounted(){await this.fetchUsers(),""!==this.id&&(await this.fetchCompany(),this.labelTitle=this.$t("company_modal.title_edit"))},methods:{async fetchUsers(){try{const e=await b.A.get(`/user/${this.userIdentify}`);this.user=e.data}catch(e){console.error("Error fetching user",e)}},async fetchCompany(){try{const e=await b.A.get(`/company/${this.id}`);this.company=e.data}catch(e){console.error("Error fetching company",e)}},async postCompany(){try{if(this.isDuplicate=await this.checkDuplicateCompany(this.company.name),this.isDuplicate)return void this.showFailedToast();const e=await b.A.post("/company",this.company),t=e.data.company._id;this.user.companies.push(t),await b.A.put(`/user/${this.userIdentify}`,this.user)}catch(e){console.error("Error posting company",e)}},async putCompany(){try{if(this.isDuplicate=await this.checkDuplicateCompany(this.company.name),this.isDuplicate)return void this.showFailedToast();await b.A.put(`/company/${this.id}`,this.company)}catch(e){console.error("Error posting company",e)}},async onSave(){""!==this.id?await this.putCompany():await this.postCompany(),this.isDuplicate||(this.innerVisible=!1,this.$emit("companyUpdated"))},async checkDuplicateCompany(e){try{const t=await b.A.get("/company"),a=t.data.filter((t=>this.user.companies.some((a=>a===t._id&&e.toLowerCase()===t.name.toLowerCase()&&t._id!==this.id))));return a.length>0}catch(t){return console.error("Error checking duplicate company",t),!1}},onCancel(){this.innerVisible=!1}}}),A=a(1241);const U=(0,A.A)(T,[["render",$]]);var S=U,W=a(8797),E=a(1749),N=(a(5839),a(3230)),j=(0,i.pM)({name:"HomePage",components:{CompanyModal:S,DeleteModal:W.A},data(){return{companies:[],filteredCompanies:[],user:{},modalData:{},isModalVisible:!1,isDeleteModalVisible:!1,store:(0,x.Pj)(),isLoaded:!1,statusActive:this.$t("companies_page.table_status_value_active"),statusInactive:this.$t("companies_page.table_status_value_inactive"),userIdentify:"",userNameIdentify:"",searchText:"",idCompany:""}},created(){const e=(0,x.Pj)(),t=e.state.userId,a=e.state.userName;t||a||L.A.push("/"),this.userIdentify=t,this.userNameIdentify=a},async mounted(){this.userIdentify&&(await this.fetchUsers(),await this.fetchCompanies(),this.isLoaded=!0)},methods:{async fetchUsers(){try{const e=await b.A.get(`/user/${this.userIdentify}`);this.user=e.data}catch(e){console.error("Error fetching user",e)}},async fetchCompanies(){try{const e=await b.A.get("/company");this.companies=e.data,this.companies=this.companies.filter((e=>this.user.companies.includes(e._id))),this.filteredCompanies=this.companies}catch(e){console.error("Error fetching companies:",e)}},async handlerFilteringCompanies(){await this.fetchUsers(),this.fetchCompanies()},getStatus(e){return 1===e?this.statusActive:this.statusInactive},openModal(e){this.idCompany=e?e._id:"",this.isModalVisible=!0},closeModal(){this.isModalVisible=!1},onDelete(e){this.companies=this.companies.filter((t=>t._id!==e))},onConfirm(e){this.isModalVisible=!1,this.$emit("onConfirm",e)},deleteItem(e){this.idCompany=e._id,this.isDeleteModalVisible=!0},goToBranche(e){L.A.push(`/branch/${e._id}`)},formatCurrency(e){if(!e||isNaN(parseFloat(e)))return"";const t=parseFloat(e);return"$"+t.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")},exportToPDF(){const e=new E["default"]("p","pt","a4"),t=[{title:"Name",dataKey:"name"},{title:"Sector",dataKey:"sector"},{title:"Valuation",dataKey:"valuation"},{title:"Status",dataKey:"active"}],a=this.filteredCompanies.map((e=>({name:e.name,sector:e.sector,valuation:this.formatCurrency(e.valuation.toString()),active:this.getStatus(e.active)})));e.autoTable({head:[t.map((e=>e.title))],body:a.map((e=>t.map((t=>e[t.dataKey])))),startY:40,styles:{overflow:"linebreak"},columnStyles:{0:{cellWidth:150},1:{cellWidth:100},2:{cellWidth:150},3:{cellWidth:100}}}),e.save("companies.pdf")},exportToExcel(){const e=this.filteredCompanies.map((e=>({Name:e.name,Sector:e.sector,Valuation:this.formatCurrency(e.valuation.toString()),Status:this.getStatus(e.active)}))),t=N.Wp.json_to_sheet(e),a=N.Wp.book_new();N.Wp.book_append_sheet(a,t,"Companies"),N._h(a,"companies.xlsx")},filterCompanies(){const e=this.searchText.toLowerCase();this.filteredCompanies=this.companies.filter((t=>t.name?.toLowerCase().includes(e)||t.sector?.toLowerCase().includes(e)||t.valuation?.toString().includes(e)||(1===t.active?this.statusActive:this.statusInactive).toLowerCase().startsWith(e)))}}});const K=(0,A.A)(j,[["render",y],["__scopeId","data-v-0fa16ce0"]]);var B=K}}]);
//# sourceMappingURL=135.bb0a8142.js.map